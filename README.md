#  Дипломная работа по профессии «Системный администратор»

## Задача
Ключевая задача — разработать отказоустойчивую инфраструктуру для сайта, включающую мониторинг, сбор логов и резервное копирование основных данных. Инфраструктура должна размещаться в [Yandex Cloud](https://cloud.yandex.com/).

---

## Инфраструктура
Для развёртывания были использованы Terraform и Ansible. Операционная система - Debian 11.

Некоторые пакеты, недоступные для скачивания под российскими IP-адресами были скачаны с зеркала Яндекса.

Файлы, используемые для развёртывания находятся в данном репозитории.

---

### Сайт
Сайт доступен по адресу:

http://158.160.120.122/site/

Проверяем работу балансировщика, выполняя в терминале следующую команду:

`curl -v <публичный IP балансера>`

Так выглядит вывод команды:

![image](https://github.com/GorkOrMork/netd/assets/109193124/9b6a6b15-1d1d-4413-b1fe-2d524fb8b0b5)


При выполнении данной команды получаем вывод, показывающий процесс маршрутизации запросов. Хост-бастион принимает запросы и передает их на балансировщик, который, в свою очередь, выбирает один из сайтов для перенаправления пользователя в зависимости от текущей нагрузки на них. Эта функциональность реализована с использованием веб-сервера Nginx.

---

### Мониторинг
Виртуальная машина создаётся при помощи Terraform, Zabbix устанавливается при помощи Ansible playbook.

Сбор данных происходит с помощью Zabbix Agent с каждой машины.

Мониторинг доступен по этому адресу:

http://158.160.120.122/zabbix

Логин: Admin

Пароль: zabbix

![image](https://github.com/GorkOrMork/netd/assets/109193124/45f06199-9071-4744-9355-6cc6c46fa489)


---

### Логи
Установка происходит при помощи Ansible Playbook 2, 3, 4.

Для корректной работы необходимо поменять IP-адреса в файлах конфигурации kibana.yml и filebeat.yml на фактические адреса виртуальных машин. Сами файлы конфигурации находятся в директории configs.

kibana.yml

![image](https://github.com/GorkOrMork/netd/assets/109193124/00a6823e-1ecb-44f7-aa87-26ce5356623c)


filebeat.yml

![image](https://github.com/GorkOrMork/netd/assets/109193124/474c0804-b318-4f35-be37-a0f22a435eb3)


![image](https://github.com/GorkOrMork/netd/assets/109193124/df26352f-da4e-4e26-aadd-d260b08cd1ea)


Мониторинг данных Vector доступен по этому адресу:

[http://158.160.41.138/app/discover#/?_g=(filters:!(),refreshInterval:(pause:!f,value:10000),time:(from:now-1w,to:now))&_a=(columns:!(),filters:!(),index:'93960162-f781-44ee-b72b-996ffc42a9e0',interval:auto,query:(language:kuery,query:''),sort:!(!('@timestamp',desc)))](http://158.160.41.138/app/discover#/view/47138ba0-565b-11ee-9ed7-81950bf72f00?_g=(filters:!(),refreshInterval:(pause:!t,value:60000),time:(from:now-2M,to:now))&_a=(columns:!(),filters:!(),grid:(),hideChart:!f,index:ab1fe0c6-d718-4d88-b501-3c0cdcf98ef1,interval:auto,query:(language:kuery,query:''),sort:!(!(timestamp,desc))))

Логи управляются и визуализируются с использованием Kibana, Elasticsearch и Filebeat. Kibana используется для визуализации логов Nginx, а Filebeat служит для импорта логов из виртуальных машин с сайтами.

---

### Сеть
Сетевая политика UFW настроена таким образом, чтобы блокировать все входящие подключения на каждой виртуальной машине, за исключением необходимых компонентов сети и узла-бастиона, которые имеют соответствующие открытые порты (например, порт 10050 для Zabbix, порт 80 для HTTP-запросов на виртуальные машины с сайтами и т.д.).

Теперь, подключиться по SSH можно подключиться к любой машине в сети только из узла-бастиона.

Узел-бастион перенаправляет запросы на балансировщик, Kibana или Zabbix в зависимости от URL.

---

### Резервное копирование
В панели управления Яндекс Клауд было настроено создание снапшотов. Резервное копирование происходит ежедневно, срок хранения резервной копии - одна неделя. Как и требовалось.

![image](https://github.com/GorkOrMork/netd/assets/109193124/ddd96ace-2a1c-4d65-b8b5-a861b245bfba)

